version: "3.8"

services:
      nats-server:
            image: nats:latest
            # Exponemos el puero NATS_SERVER_DASHBOARD_PORT para disponer del dashboard de nats en desarrollo, en produccion no es necesario
            ports:
                  - ${NATS_SERVER_DASHBOARD_PORT}:${NATS_SERVER_DASHBOARD_PORT}

      client-gateway:
            build: ./client-gateway
            ports:
                  - ${CLIENT_GATEWAY_PORT}:3000
            volumes:
                  - ./client-gateway/src:/usr/src/app/src
            command: npm run start:dev
            environment:
                  - PORT=3000
                  - NATS_SERVERS=${NATS_SERVER_CONNECTION_URI}

      products-ms:
            build: ./products-ms
            volumes:
                  - ./products-ms/src:/usr/src/app/src
            command: npm run start:dev
            environment:
                  - PORT=3001
                  - NATS_SERVERS=${NATS_SERVER_CONNECTION_URI}
                  - DATABASE_URL=file:./dev.db

      # orders-ms:
      #       depends_on:
      #             - orders-db
      #       build: ./orders-ms
      #       volumes:
      #             - ./orders-ms/src:/usr/src/app/src
      #       command: npm run start:dev
      #       environment:
      #             - PORT=3002
      #             - NATS_SERVERS=${NATS_SERVER_CONNECTION_URI}
      #             - DATABASE_URL=postgres://${ORDERS_POSTGRES_USER}:${ORDERS_POSTGRES_PASSWORD}@orders-db:5432/${ORDERS_POSTGRES_DB}?schema=public

      # orders-db:
      #       container_name: orders_database
      #       image: postgres:latest
      #       restart: always
      #       volumes:
      #             - ./orders-ms/postgres:/var/lib/postgresql/data
      #       # Esto expone la base de datos en el puerto 5432 al publico, solo debe ser usado en desarrollo
      #       ports:
      #             - "5432:5432"
      #       environment:
      #             POSTGRES_USER: ${ORDERS_POSTGRES_USER}
      #             POSTGRES_PASSWORD: ${ORDERS_POSTGRES_PASSWORD}
      #             POSTGRES_DB: ${ORDERS_POSTGRES_DB}
